<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>我的档案 - 大学生岗位胜任力提升平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="assets/sidebar.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&amp;family=Plus+Jakarta+Sans:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif; }
        h1,h2,h3,h4{ font-family: 'Plus Jakarta Sans', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen">
    <main class="max-w-4xl mx-auto p-6">
        <header class="mb-6 flex items-center justify-between">
            <h1 class="text-2xl font-semibold">我的档案</h1>
            <div class="flex items-center gap-4">
                <a href="index.html" class="text-sm text-blue-600 hover:underline">返回主页</a>
                <button id="logoutBtn" class="text-sm text-red-600 hover:underline">退出登录</button>
            </div>
        </header>

        <section class="grid lg:grid-cols-3 gap-6">
            <div class="lg:col-span-1 bg-white rounded-2xl border border-slate-200 p-6">
                <div class="flex flex-col items-center text-center">
                    <img id="pf-avatar" src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?q=80&w=200&auto=format&fit=crop" alt="avatar" class="w-28 h-28 rounded-full object-cover mb-4 border-4 border-white shadow-md">
                    <h2 id="pf-name" class="text-xl font-semibold text-slate-900">用户</h2>
                    <p id="pf-title" class="text-sm text-slate-500 mb-3">求职中 · 前端工程师</p>
                    <div class="flex gap-2 mb-3">
                        <span id="pf-location" class="text-xs text-slate-400">上海</span>
                        <span class="text-xs text-slate-400">·</span>
                        <span id="pf-availability" class="text-xs text-green-600 font-medium">随时到岗</span>
                    </div>
                    <div class="flex gap-2">
                        <a id="pf-edit" class="px-3 py-1 text-sm bg-blue-600 text-white rounded-lg">编辑资料</a>
                        <label class="px-3 py-1 text-sm bg-slate-100 rounded-lg cursor-pointer"><input id="pf-upload" type="file" accept="image/*" class="hidden"> 上传头像</label>
                    </div>
                </div>

                <div class="mt-6">
                    <h3 class="text-sm font-semibold text-slate-700 mb-2">联系方式</h3>
                    <div class="text-sm text-slate-600" id="pf-contact">邮箱: 未填写<br>电话: 未填写</div>
                </div>

                <div class="mt-6">
                    <h3 class="text-sm font-semibold text-slate-700 mb-2">技能标签</h3>
                    <div id="pf-skills" class="flex flex-wrap gap-2 text-xs"></div>
                </div>
            </div>

            <div class="lg:col-span-2 space-y-6">
                <div class="bg-white rounded-2xl border border-slate-200 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-slate-900">个人简介</h3>
                        <span class="text-xs text-slate-400">可以简短说明你的职业方向与期望</span>
                    </div>
                    <p id="pf-bio" class="text-sm text-slate-700">暂无个人简介。点击编辑添加。</p>
                </div>

                <div class="bg-white rounded-2xl border border-slate-200 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-slate-900">工作经验</h3>
                        <button id="addExp" class="text-sm text-blue-600">添加</button>
                    </div>
                    <div id="pf-exps" class="space-y-4 text-sm text-slate-700">
                        <div class="p-3 border rounded-lg bg-slate-50">
                            <div class="flex justify-between"><div><strong>前端实习生</strong><div class="text-xs text-slate-500">某互联网公司 · 2023.06 - 2023.12</div></div><div class="text-xs text-slate-500">杭州</div></div>
                            <p class="mt-2 text-xs text-slate-600">负责页面组件开发与性能优化，参与多人协作项目。</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl border border-slate-200 p-6">
                    <h3 class="text-lg font-semibold text-slate-900 mb-3">期望职位 / 简历</h3>
                    <div class="flex items-center gap-4">
                        <div class="flex-1 text-sm text-slate-700" id="pf-wish">期望：前端开发 / 全栈（可远程）</div>
                        <div>
                            <button id="pf-download" class="px-3 py-1 bg-blue-600 text-white rounded-lg text-sm">下载简历</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        lucide.createIcons();
        (function(){
            // Restore persistent login
            if(localStorage.getItem('uni_auth')==='true'){
                sessionStorage.setItem('uni_auth','true');
                sessionStorage.setItem('uni_user', localStorage.getItem('uni_user'));
            }
            if(sessionStorage.getItem('uni_auth')!=='true'){
                location.href = 'login.html';
                return;
            }

            // Load profile data from localStorage
            const user = sessionStorage.getItem('uni_user') || localStorage.getItem('uni_user') || '用户';
            const data = JSON.parse(localStorage.getItem('profile_data') || '{}');

            // Elements
            const pfName = document.getElementById('pf-name');
            const pfAvatar = document.getElementById('pf-avatar');
            const pfTitle = document.getElementById('pf-title');
            const pfLocation = document.getElementById('pf-location');
            const pfAvailability = document.getElementById('pf-availability');
            const pfContact = document.getElementById('pf-contact');
            const pfSkills = document.getElementById('pf-skills');
            const pfBio = document.getElementById('pf-bio');
            const pfExps = document.getElementById('pf-exps');
            const pfWish = document.getElementById('pf-wish');

            pfName.textContent = data.name || user;
            if(data.avatar) pfAvatar.src = data.avatar;
            pfTitle.textContent = data.title || '求职中 · 前端工程师';
            pfLocation.textContent = data.location || '未填写';
            pfAvailability.textContent = data.availability || '随时到岗';
            pfContact.innerHTML = (data.email?('邮箱: '+data.email):'邮箱: 未填写')+ '<br>' + (data.phone?('电话: '+data.phone):'电话: 未填写');
            pfBio.textContent = data.bio || '暂无个人简介。点击编辑添加。';
            pfWish.textContent = data.wish || '期望：前端开发 / 全栈（可远程）';

            // render skills
            (data.skills || ['HTML','CSS','JavaScript']).forEach(s=>{
                const el = document.createElement('span');
                el.className = 'px-2 py-1 bg-slate-100 text-slate-700 text-xs rounded';
                el.textContent = s;
                pfSkills.appendChild(el);
            });

            // simple exp list rendering if any
            if(Array.isArray(data.exps)){
                pfExps.innerHTML = '';
                data.exps.forEach(e=>{
                    const d = document.createElement('div');
                    d.className = 'p-3 border rounded-lg bg-slate-50';
                    d.innerHTML = '<div class="flex justify-between"><div><strong>'+ (e.title || '') +'</strong><div class="text-xs text-slate-500">'+ (e.company||'') +' · '+ (e.range||'') +'</div></div><div class="text-xs text-slate-500">'+ (e.location||'') +'</div></div><p class="mt-2 text-xs text-slate-600">'+ (e.desc||'') +'</p>';
                    pfExps.appendChild(d);
                });
            }

            // logout
            const logoutBtn = document.getElementById('logoutBtn');
            logoutBtn.addEventListener('click', function(){
                sessionStorage.removeItem('uni_auth');
                sessionStorage.removeItem('uni_user');
                localStorage.removeItem('uni_auth');
                localStorage.removeItem('uni_user');
                location.href = 'login.html';
            });

            // Edit profile (simple prompt-based edits for demo)
            document.getElementById('pf-edit').addEventListener('click', function(){
                const name = prompt('姓名：', data.name || user) || data.name || user;
                const title = prompt('头衔/求职方向：', data.title || '') || data.title || '';
                const email = prompt('邮箱：', data.email || '') || data.email || '';
                const phone = prompt('电话：', data.phone || '') || data.phone || '';
                const bio = prompt('个人简介：', data.bio || '') || data.bio || '';
                const skills = prompt('技能（用逗号分隔）：', (data.skills||[]).join(',')) || (data.skills||[]).join(',');
                data.name = name; data.title = title; data.email = email; data.phone = phone; data.bio = bio; data.skills = skills.split(',').map(s=>s.trim()).filter(Boolean);
                localStorage.setItem('profile_data', JSON.stringify(data));
                location.reload();
            });

            // Upload avatar (store as data URL)
            document.getElementById('pf-upload').addEventListener('change', function(e){
                const f = e.target.files && e.target.files[0];
                if(!f) return;
                const r = new FileReader();
                r.onload = function(){
                    data.avatar = r.result;
                    localStorage.setItem('profile_data', JSON.stringify(data));
                    pfAvatar.src = r.result;
                };
                r.readAsDataURL(f);
            });

            // download resume placeholder
            document.getElementById('pf-download').addEventListener('click', function(){
                alert('这是演示下载（未上传简历）。可在编辑中添加简历链接或上传功能。');
            });

            // add experience quick prompt
            document.getElementById('addExp').addEventListener('click', function(){
                const title = prompt('职位：','')||'';
                if(!title) return;
                const company = prompt('公司：','')||'';
                const range = prompt('时间范围：','')||'';
                const location = prompt('地点：','')||'';
                const desc = prompt('描述：','')||'';
                data.exps = data.exps||[];
                data.exps.unshift({title,company,range,location,desc});
                localStorage.setItem('profile_data', JSON.stringify(data));
                location.reload();
            });

        })();
    </script>
    <script src="assets/sidebar.js" defer></script>
</body>
</html>